const DirectFire = (msg) => {
    let Tag = msg.content.split(";");
    let shooter = UnitArray[Tag[1]];
    let target = UnitArray[Tag[2]];

    let losResult = LOS(shooter,target);
    let errorMsg = [];
    if (losResult.los === false) {
        errorMsg.push("[#ff0000]No LOS to Target[/#]");
        errorMsg.body.push(losResult.losReason);
    }
    if (losResult.distance > shooter.range[2]) {
        errorMsg.push("[#ff0000]Target is Out of Range");
    }
    let targetFacing = losResult.targetFacing;
    let shooterFacing = losResult.shooterFacing;

    let armour = (targetFacing === "Front") ? target.armourF:target.armourSR;
    let wpn = 0; //either pen or ai
    let wpnTip = "";
    let type = "Armour";
    if (armour !== "NA") {
        wpn = shooter.pen;
        let note = "";
        if (wpn.includes("(")) {
            let ip = wpn.split("(");
            wpn = parseInt(ip[0]);
            let penRange = parseInt(ip[1].replace(/[^0-9]+/g, ''));
            if (losResult.distance > penRange) {
                wpn = 0;
            }
            note = " with this range"
        } else {
            wpn = parseInt(wpn);
        }
        wpnTip = "Base Pen: " + wpn;
        if (wpn === 0) {
            errorMsg.push("No Anti-Tanks Weapons" + note);
        } else {
            //pen for tanks up or down
            if (shooter.type !== "Infantry" && shooter.type !== "Horse") {
                if (losResult.distance > shooter.range[1]) {
                    wpn -= 2;
                    wpnTip += "<br>-2 Pen for Long Range";
                }
                if (losResult.distance <= shooter.range[0]) {
                    wpn += 2;
                    wpnTip += "<br>+2 Pen for Short Range";
                }
            }
        }
    } else {
        type = "AntiInfantry";
        wpn = shooter.antiInf;
        if (wpn.includes("(")) {
            let ip = wpn.split("(");
            wpn = parseInt(ip[0]);
            ip = ip[1].replace(/(|)/g,"");
            if (ip === "Close Only" || ip === "Close") {
                if (losResult.distance > shooter.range[0]) {
                    wpn = 0;
                }
            }
        }
        wpnTip = "Base AI: " + wpn;
        if (wpn === "NA") {
            errorMsg.push("No Anti-Infantry Weapons");
        }
    }

    if (errorMsg.length > 0) {
        _.each(errorMsg,msg => {
            outputCard.body.push(msg);
        })
        PrintCard();
        return;
    }

    //so will have ai or pen as 'wpn' and wpnTip has base info
    let toHit = 4;
    let toHitTip = "Base 4+";
    if (shooter.quality.includes("Good") || shooter.quality.includes("Excellent")) {
        toHitTip += "<br>+1 Quality";
        toHit--;
    }
    if (losResult.distance <= shooter.range[0]) {
        toHit--;
        toHitTip += "<br>+1 Short Range";
    }
    if (losResult.distance > shooter.range[1]) {
        toHit++;
        toHitTip += "<br>-1 Long Range";
    }
    if (shooter.token.get(SM.suppressed)) {
        toHit++;
        toHitTip += "<br>-1 Suppressed";
    }
    if (shooter.token.get("aura1_color") === "#ff00ff") {
        toHit++;
        toHitTip += "<br>-1 Overwatch";
    }
    
    let ROF = parseInt(shooter.rof);

    let rolls = [];
    let hits = 0;coverSaves = 0;finalHits = 0;
    for (let i=0;i<ROF;i++) {
        let roll = randomInteger(6);
        rolls.push(roll);
        if (roll >= toHit) {
            hits++;
        }
    }
    //cover saves
    let cover = HexMap[target.hexLabel].cover;
    let coverRolls = [];
    let coverTip = "";
    if (cover > 0) {
        coverTip = (cover === 1) ? "Soft Cover 5+ Save":"Hard Cover 4+ Save";
        let coverSave = (cover === 1) ? 5:4;
        for (let i=0;i<hits;i++) {
            let coverRoll = randomInteger(6);
            coverRolls.push(coverRoll);
            if (coverRoll >= coverSave) {
                coverSaves++;
            }
        }
    }
    finalHits = hits - coverSaves;

    if (finalHits === 0) {
        




    } else {
        //anti-armour - compare
/*
After rolling for hits, vehicles must then roll for effect to determine damage. Is it a brew up or just a deflection? Let’s find out! For each hit against a vehicle, compare the Armor of the target to the Penetration rating of the firer. Roll a number of d6 equal to the Penetration less the Armor. If the two are equal, roll 1 die. If Penetration is less than Armor, roll 1 die and apply the difference between the Penetration and Armor as a negative modifier.
Attacks at Short range (does not apply to infantry) add +2 Penetration and attacks at Long range suffer -2 Penetration.
Each result of 6 automatically destroys the vehicle. A result of 4-5 forces a Quality Check, and any result of 3 or less has no effect on the target.
*/

        //anti-infantry 
/*
Unlike vehicle attacks, infantry do not have an Armor rating. Each hit against infantry is marked for a future Quality Check. A result of “6” against infantry is only a Quality Check, not an instant kill. There are no instant kills against infantry!
*/




    }








//rotate certain units eg tank destroyers, infantry --> basically those without turrets
//Sound and FX (?)


}